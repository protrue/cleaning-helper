<Window x:Class="CleaningHelper.Gui.FramesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:CleaningHelper.Gui"
        xmlns:gs="clr-namespace:GraphSharp.Controls;assembly=GraphSharp.Controls"
        xmlns:ext="clr-namespace:WPFExtensions.Controls;assembly=WPFExtensions"
        xmlns:model="clr-namespace:CleaningHelper.Model;assembly=CleaningHelper.Model"
        xmlns:vm="clr-namespace:CleaningHelper.ViewModel;assembly=CleaningHelper.ViewModel"
        mc:Ignorable="d"
        Title="Редактор фреймов"
        Icon="Resources/icon.ico"
        Height="600"
        Width="800">

    <Window.Resources>
        <DataTemplate x:Key="FrameTemplate" DataType="{x:Type model:Frame}">
            <StackPanel Margin="5">
                <TextBlock Text="{Binding Path=Name}"/>
            </StackPanel>
        </DataTemplate>

        <Style TargetType="{x:Type gs:VertexControl}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type gs:VertexControl}">
                        <Border
                            BorderBrush="Black"
                            BorderThickness="1">
                            <ContentPresenter
                                Content="{TemplateBinding Vertex}"
                                ContentTemplate="{StaticResource FrameTemplate}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <Menu DockPanel.Dock="Top">
            <MenuItem
                Header="Редактировать домены"
                Click="MenuItem_Click"></MenuItem>
        </Menu>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"></ColumnDefinition>
                <ColumnDefinition Width="1*"></ColumnDefinition>
            </Grid.ColumnDefinitions>

            <GroupBox
                Grid.Column="0"
                Header="Визуализация">
                <DockPanel>
                    <DockPanel DockPanel.Dock="Top" LastChildFill="False">
                        <Button Name="AddFrameButton" Content="Добавить" Margin="10 5" Padding="5" Click="AddFrameButton_OnClick"></Button>
                        <Button Name="RemoveFrameButton" Content="Удалить" Margin="10 5" Padding="5" Click="RemoveFrameButton_OnClick" IsEnabled="{Binding Path=IsFrameSelected}"></Button>
                    </DockPanel>

                    <ext:ZoomControl
                        Name="ZoomControl"
                        Mode="Original"
                        ModifierMode="None">
                        <gs:GraphLayout
                            Name="GraphLayout"
                            LayoutAlgorithmType="Tree"
                            OverlapRemovalAlgorithmType="FSA"
                            PreviewMouseLeftButtonDown="GraphLayout_PreviewMouseLeftButtonDown"
                            LayoutMode="Compound">
                            <gs:GraphLayout.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Добавить"></MenuItem>
                                    <MenuItem Header="Удалить" IsEnabled="{Binding Path=IsFrameSelected}" Click="RemoveFrameButton_OnClick"></MenuItem>
                                </ContextMenu>
                            </gs:GraphLayout.ContextMenu>
                        </gs:GraphLayout>
                    </ext:ZoomControl>
                </DockPanel>
            </GroupBox>

            <GroupBox
            Header="Инспектор слотов фрейма"
            Grid.Column="1">
                <DockPanel LastChildFill="True">
                    <TextBox
                        DockPanel.Dock="Top"
                        Text="{Binding Path=SelectedFrame.Name, UpdateSourceTrigger=PropertyChanged}"
                        Padding="5">
                    </TextBox>
                    <DataGrid
                        Name="SlotsDataGrid"
                        ItemsSource="{Binding Path=SelectedFrame.Slots}"
                        AutoGenerateColumns="False">
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem
                                    Name="AddSlotMenuItem"
                                    Header="Добавить" Click="AddSlotMenuItem_Click" IsEnabled="{Binding Path=IsFraneSelected}">
                                </MenuItem>
                                <MenuItem
                                    Name="EditSlotMenuItem"
                                    Header="Редактировать домен" IsEnabled="{Binding Path=IsSlotSelected}" Click="EditSlotMenuItem_OnClick">
                                </MenuItem>
                                <MenuItem
                                    Name="RemoveSlotMenuItem"
                                    Header="Удалить" IsEnabled="{Binding Path=IsSlotSelected}" Click="RemoveSlotMenuItem_OnClick">
                                </MenuItem>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.Columns>
                            <DataGridTextColumn
                        Header="Имя" 
                        Binding="{Binding Path=Name}"
                        Width="*"/>
                            <DataGridComboBoxColumn 
                                x:Name="DomainComboBoxColumn"
                                Header="Тип"
                                Width="*"
                                ItemsSource="{Binding Path=FrameModel.Domains}"
                                DisplayMemberPath="Name"
                                SelectedItemBinding="{Binding Path=SelectedSlot.Domain}"/>
                            <DataGridComboBoxColumn
                                x:Name="ValueComboBoxColumn"
                                Header="Значение"
                                Width="*"
                                DisplayMemberPath="Text"
                                SelectedItemBinding="{Binding Path=SelectedSlot.Value}">
                                <DataGridComboBoxColumn.ElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter
                                            Property="ItemsSource"
                                            Value="{Binding Path=Domain.Values}"/>
                                    </Style>
                                </DataGridComboBoxColumn.ElementStyle>
                                <DataGridComboBoxColumn.EditingElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter
                                            Property="ItemsSource"
                                            Value="{Binding Path=Domain.Values}"/>
                                    </Style>
                                </DataGridComboBoxColumn.EditingElementStyle>
                            </DataGridComboBoxColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </GroupBox>
        </Grid>
    </DockPanel>
</Window>
